<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Uncertainty Estimation &mdash; SAINT Lightning 0.0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example Classification" href="example_classification.html" />
    <link rel="prev" title="Data Augmentation Techniques" href="augmentations.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> SAINT Lightning
          </a>
              <div class="version">
                0.2.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Network Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="augmentations.html">Data Augmentation Techniques</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Uncertainty Estimation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#monte-carlo-dropout">Monte Carlo Dropout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#implementation">Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-it">How to use it</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_classification.html">Example Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_regression.html">Example Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="_generated/lit_saint.html">lit_saint package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SAINT Lightning</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Uncertainty Estimation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/uncertainty.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="uncertainty-estimation">
<h1>Uncertainty Estimation<a class="headerlink" href="#uncertainty-estimation" title="Permalink to this headline"></a></h1>
<section id="monte-carlo-dropout">
<h2>Monte Carlo Dropout<a class="headerlink" href="#monte-carlo-dropout" title="Permalink to this headline"></a></h2>
<p>Monte Carlo Dropout, proposed by <a class="reference external" href="https://arxiv.org/abs/1506.02142">Gal &amp; Ghahramani</a> (2016),
is a clever realization that the use of the regular dropout can be interpreted
as a Bayesian approximation of a well-known probabilistic model: the Gaussian process.
We can treat the many different networks (with different neurons dropped out)
as Monte Carlo samples from the space of all available models.
This provides mathematical grounds to reason about the model’s uncertainty and, as it turns out,
often improves its performance.</p>
<p>How does it work? We simply apply dropout at test time, that’s all!</p>
<section id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline"></a></h3>
<p>In the function predict_step of the LightningModule is added this code:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Dropout&#39;</span><span class="p">):</span>
        <span class="n">m</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</pre></div>
</div>
<p>In this way all the Dropout layers become trainable during the predict step and so
we will get different prediction anytime we call the model on the same data</p>
</section>
<section id="how-to-use-it">
<h3>How to use it<a class="headerlink" href="#how-to-use-it" title="Permalink to this headline"></a></h3>
<p>Using the SaintTrainer is possible to specify the number of iterations to use for the
MCDropout in the predict, when it is zero it doesn’t use the algorithm and return the standard result.
The dimension of the output will be [N_SAMPLE, N_CLASS, N_ITERATION] where:</p>
<ul class="simple">
<li><p>N_SAMPLE is equal to the number of rows of the dataset used for the prediction;</p></li>
<li><p>N_CLASS is equal to the number of classes of the problem(in case of regression is equal to 1);</p></li>
<li><p>N_ITERATION is equal to the number of iteration of the MCDropout process</p></li>
</ul>
<p>Remember to set the value for the dropout in the Transformer or/and in the embeddings different from zero,
otherwise all the predictions will have the same value and this technique will be not applicable.</p>
<p>This technique can be used to perform Active Learning, and find the the samples where the model has a greatest uncertainty
and that if we can obtain labels for these samples we can improve the performance of the network</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">prediction</span> <span class="o">=</span> <span class="n">saint_trainer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="n">data_module</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df_test</span><span class="p">,</span> <span class="n">mc_dropout_iterations</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="augmentations.html" class="btn btn-neutral float-left" title="Data Augmentation Techniques" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="example_classification.html" class="btn btn-neutral float-right" title="Example Classification" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Luca Actis Grosso.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>